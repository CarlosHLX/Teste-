<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Avaliação de Complexidade - Formulário</title>
  <style>
    :root{--bg:#f7f9fc;--card:#fff;--accent:#2563eb;--muted:#6b7280}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);margin:0;padding:12px;color:#111}
    .container{max-width:720px;margin:0 auto}
    header{margin-bottom:12px}
    header h1{font-size:18px;margin:0;line-height:1.3}
    .card{background:var(--card);border-radius:10px;box-shadow:0 4px 12px rgba(12,22,49,0.06);padding:14px}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:4px}
    input[type=text], input[type=number], input[type=date], .readonly{width:100%;padding:10px;border:1px solid #e6e9ef;border-radius:8px;font-size:15px}
    .section{margin-top:16px}
    .section h3{margin:0 0 8px 0;font-size:15px}
    .options{display:grid;grid-template-columns:1fr;gap:6px}
    .option{display:flex;align-items:center;gap:8px;padding:10px;border:1px solid #e6e9ef;border-radius:8px;font-size:14px}
    .option input{transform:scale(1.3)}
    footer{display:flex;gap:12px;align-items:center;margin-top:16px}
    .btn{flex:1;text-align:center;background:var(--accent);color:#fff;padding:12px;border-radius:8px;border:0;cursor:pointer;font-size:15px}
    .btn.secondary{background:#6b7280}
    .result{margin-top:12px;padding:12px;border-radius:8px;background:#f1f5f9;font-size:14px}
    .small{font-size:12px;color:var(--muted)}

    /* Classes de status colorido */
    .status-baixa{color:green;font-weight:bold}
    .status-media{color:orange;font-weight:bold}
    .status-alta{color:red;font-weight:bold}
    .status-inelegivel{color:gray;font-weight:bold}

    /* Esconder no PDF */
    @media print {
      .no-print {
        display: none !important;
      }
    }

    @media(min-width:640px){
      .grid{grid-template-columns:repeat(2,1fr)}
      .options{grid-template-columns:repeat(2,1fr)}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Avaliação de Complexidade</h1>
      <div class="small">Preencha e gere PDF com resultado e classificação</div>
    </header>

    <div class="card" id="printArea">
      <div class="grid">
        <div>
          <label>Efetuada em</label>
          <input type="date" id="data" />
        </div>
        <div>
          <label>Complexidade (automático)</label>
          <input type="text" id="complexidade" class="readonly" readonly />
        </div>
        <div>
          <label>Nome do Paciente</label>
          <input type="text" id="nome" placeholder="Nome completo" />
        </div>
        <div>
          <label>Idade</label>
          <input type="number" id="idade" min="0" />
        </div>
      </div>

      <!-- Seções -->
      <div class="section">
        <h3>Suporte Terapêutico</h3>
        <div class="options">
          <label class="option"><input type="checkbox" value="Sonda Vesical Permanente" data-points="1"> Sonda Vesical Permanente = 1 ponto</label>
          <label class="option"><input type="checkbox" value="Sonda Vesical Intermitente" data-points="2"> Sonda Vesical Intermitente = 2 pontos</label>
          <label class="option"><input type="checkbox" value="Traqueostomia sem Aspiração" data-points="2"> Traqueostomia sem Aspiração = 2 pontos</label>
          <label class="option"><input type="checkbox" value="Traqueostomia com Aspiração" data-points="5"> Traqueostomia com Aspiração = 5 pontos</label>
          <label class="option"><input type="checkbox" value="Aspiração de Vias Aéreas Sup." data-points="3"> Aspiração de Vias Aéreas Sup. = 3 pontos</label>
          <label class="option"><input type="checkbox" value="Acesso Venoso Prof. Continuo" data-points="5"> Acesso Venoso Prof. Continuo = 5 pontos</label>
          <label class="option"><input type="checkbox" value="Acesso Venoso Intermitente" data-points="4"> Acesso Venoso Intermitente = 4 pontos</label>
          <label class="option"><input type="checkbox" value="A. Venoso Periférico Continuo" data-points="5"> A. Venoso Periférico Continuo = 5 pontos</label>
          <label class="option"><input type="checkbox" value="Diálise Domiciliar" data-points="5"> Diálise Domiciliar = 5 pontos</label>
        </div>
      </div>

      <div class="section">
        <h3>Quimioterapia</h3>
        <div class="options">
          <label class="option"><input type="checkbox" value="Oral" data-points="1"> Oral = 1 ponto</label>
          <label class="option"><input type="checkbox" value="Subcutânea" data-points="3"> Subcutânea = 3 pontos</label>
          <label class="option"><input type="checkbox" value="Intravenosa" data-points="5"> Intravenosa = 5 pontos</label>
          <label class="option"><input type="checkbox" value="Intratecal" data-points="5"> Intratecal = 5 pontos</label>
        </div>
      </div>

      <div class="section">
        <h3>Suporte Ventilatório</h3>
        <div class="options">
          <label class="option"><input type="checkbox" value="O² intermitente" data-points="2"> O² intermitente = 2 pontos</label>
          <label class="option"><input type="checkbox" value="O² contínuo" data-points="3"> O² contínuo = 3 pontos</label>
          <label class="option"><input type="checkbox" value="Ventilação Mec. Intermitente" data-points="4"> Ventilação Mec. Intermitente = 4 pontos</label>
          <label class="option"><input type="checkbox" value="Ventilação Mecânica Contínua" data-points="5"> Ventilação Mecânica Contínua = 5 pontos</label>
        </div>
      </div>

      <div class="section">
        <h3>Lesão Vascular/Cutânea</h3>
        <div class="options">
          <label class="option"><input type="checkbox" value="Úlcera de Pressão Grau I" data-points="2"> Úlcera de Pressão Grau I = 2 pontos</label>
          <label class="option"><input type="checkbox" value="Úlcera de Pressão Grau II" data-points="3"> Úlcera de Pressão Grau II = 3 pontos</label>
          <label class="option"><input type="checkbox" value="Úlcera de Pressão Grau III" data-points="4"> Úlcera de Pressão Grau III = 4 pontos</label>
          <label class="option"><input type="checkbox" value="Úlcera de Pressão Grau IV" data-points="5"> Úlcera de Pressão Grau IV = 5 pontos</label>
        </div>
      </div>

      <div class="section">
        <h3>Atividade da Vida Diária</h3>
        <div class="options">
          <label class="option"><input type="checkbox" value="Independente" data-points="0"> Independente = 0 ponto</label>
          <label class="option"><input type="checkbox" value="Semi-Dependente" data-points="2"> Semi-Dependente = 2 pontos</label>
          <label class="option"><input type="checkbox" value="Dependente Total" data-points="5"> Dependente Total = 5 pontos</label>
        </div>
      </div>

      <div class="section">
        <h3>Dependência de Reabilitação</h3>
        <div class="options">
          <label class="option"><input type="checkbox" value="Independente" data-points="0"> Independente = 0 ponto</label>
          <label class="option"><input type="checkbox" value="Dependente" data-points="2"> Dependente = 2 pontos</label>
        </div>
      </div>

      <div class="section">
        <h3>Terapia Nutricional</h3>
        <div class="options">
          <label class="option"><input type="checkbox" value="Suplementação Oral" data-points="1"> Suplementação Oral = 1 ponto</label>
          <label class="option"><input type="checkbox" value="Gastrostomia" data-points="2"> Gastrostomia = 2 pontos</label>
          <label class="option"><input type="checkbox" value="SNE" data-points="3"> SNE = 3 pontos</label>
          <label class="option"><input type="checkbox" value="Jejuno Ileo" data-points="3"> Jejuno Ileo = 3 pontos</label>
          <label class="option"><input type="checkbox" value="Nutrição Parenteral Total" data-points="5"> Nutrição Parenteral Total = 5 pontos</label>
        </div>
      </div>

      <div class="result" id="resultado">
        <div><strong>Total de Pontos:</strong> <span id="total">0</span></div>
        <div><strong>Classificação:</strong> <span id="classificacao">-</span></div>
        <div class="small" style="margin-top:6px">Observação: marcar 1 opção de 5 pontos → Média Complexidade. Marcar 2 ou mais opções de 5 pontos → Alta Complexidade.</div>
      </div>

      <!-- Botões escondidos no PDF -->
      <div class="no-print" style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="calcular">Recalcular</button>
        <button class="btn secondary" id="limpar">Limpar</button>
        <button class="btn" id="gerarPdf">Gerar PDF</button>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script>
    function toNumber(v){
      const n=parseInt(v,10)
      return isNaN(n)?0:n
    }

    function calcular(){
      const checkboxes=Array.from(document.querySelectorAll('#printArea input[type="checkbox"]'))
      let total=0,count5=0,selectedItems=[]
      checkboxes.forEach(cb=>{
        if(cb.checked){
          const pts=toNumber(cb.getAttribute('data-points'))
          total+=pts
          selectedItems.push({label:cb.value,pts})
          if(pts===5)count5++
        }
      })
      let classificacao='',classCss=''
      if(count5>=2){ classificacao='Alta Complexidade'; classCss='status-alta' }
      else if(count5===1){ classificacao='Média Complexidade'; classCss='status-media' }
      else{
        if(total<8){ classificacao='Paciente não elegível para Internação Domiciliar'; classCss='status-inelegivel' }
        else if(total<=12){ classificacao='Baixa Complexidade'; classCss='status-baixa' }
        else if(total<=18){ classificacao='Média Complexidade'; classCss='status-media' }
        else { classificacao='Alta Complexidade'; classCss='status-alta' }
      }
      document.getElementById('total').textContent=total
      const classifElem=document.getElementById('classificacao')
      classifElem.textContent=classificacao
      classifElem.className=classCss
      document.getElementById('complexidade').value=classificacao
      return{total,count5,selectedItems,classificacao,classCss}
    }

    document.getElementById('calcular').addEventListener('click',e=>{e.preventDefault();calcular()})
    document.querySelectorAll('#printArea input').forEach(inp=>inp.addEventListener('change',()=>calcular()))
    document.getElementById('limpar').addEventListener('click',()=>{
      document.querySelectorAll('#printArea input[type="checkbox"]').forEach(i=>i.checked=false)
      document.querySelectorAll('#printArea input[type="text"],#printArea input[type="number"]').forEach(i=>i.value='')
      document.getElementById('total').textContent='0'
      const classifElem=document.getElementById('classificacao')
      classifElem.textContent='-'
      classifElem.className=''
      document.getElementById('complexidade').value=''
    })

    document.getElementById('gerarPdf').addEventListener('click',()=>{
      const data=calcular()
      let list=document.getElementById('selecoes-list')
      if(!list){list=document.createElement('div');list.id='selecoes-list';list.style.marginTop='12px';document.getElementById('printArea').appendChild(list)}
      const nome=document.getElementById('nome').value||'-'
      const idade=document.getElementById('idade').value||'-'
      const dataef=document.getElementById('data').value||'-'
      let html=`<h2>Ficha de Avaliação</h2>`
      html+=`<div><strong>Efetuada em:</strong> ${dataef}</div>`
      html+=`<div><strong>Nome:</strong> ${nome} — <strong>Idade:</strong> ${idade}</div>`
      html+=`<hr/>`
      html+=`<div><strong>Total de Pontos:</strong> ${data.total}</div>`
      html+=`<div><strong>Classificação:</strong> <span class="${data.classCss}">${data.classificacao}</span></div>`
      html+=`<h3>Seleções</h3><ul>`
      data.selectedItems.forEach(it=>{html+=`<li>${it.label} — ${it.pts} ponto(s)</li>`})
      html+=`</ul>`
      list.innerHTML=html
      const element=document.getElementById('printArea')
      const opt={margin:10,filename:`avaliacao_${(nome||'paciente').replace(/\s+/g,'_').toLowerCase()}.pdf`,image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}}
      html2pdf().set(opt).from(element).save()
    })

    ;(function init(){const d=new Date();document.getElementById('data').value=d.toISOString().slice(0,10);calcular()})()
  </script>
</body>
</html>
